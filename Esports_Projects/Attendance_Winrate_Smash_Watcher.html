<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>A webapp which tracks ESports Attendance.</title>
        <meta name="description" content="This page allows you to see a specified players' winrate.">

        <link rel="stylesheet" href="index.css">
        <link rel="stylesheet" href="topnav.css">
        <link rel="icon" type="image/x-icon" href="LCHS_Favicon.ico">

        <script>
            let PlayerNameCache = {};
            async function GetPlayerName(id) {
                return new Promise((res) => {
                    if (PlayerNameCache[id] == null) {
                        let playerURL = `https://micahb.dev/Esports_Projects/Players/${id}.json`;
                        fetch(playerURL)
                            .then((response) => response.json())
                            .then((d) => {
                                PlayerNameCache[id] = d.Name;
                                return res(PlayerNameCache[id]);
                            });
                    }
                    else res(PlayerNameCache[id]);
                })
            }

            let LoopNum = -1;
            function Loop() {
                LoopNum = (LoopNum + 1) % 10;
                
                // Update interval text.
                document.getElementById("TimeUntilUpdate").innerText = `Updating in ${10 - LoopNum} seconds.`

                // Update rankings.
                if (LoopNum == 0)
                    fetch("https://micahb.dev/Esports_Projects/Modules/GetPlayersBySkill.js&cache=false")
                        .then((response) => response.json())
                        .then(async (data) => {
                            document.getElementById("Rankings").innerHTML = "";
                            // Add each player to the list.
                            for (let i = 0; i < data.players.length; i++) {
                                let player = data.players[i].split(" ");
                                let Skill = player[0].toString();
                                Skill = Skill.substring(0, Skill.indexOf(".") + 2)
                                document.getElementById("Rankings").innerHTML +=
                                    `<li>${await GetPlayerName(player[1])}, ${Skill} Skill`
                            }
                        });
            }

            setInterval(Loop, 1000);
        </script>
    </head>

    <body onload="Loop()">
        <div class="topnav">
            <a href="Attendance_Home.html">Home</a>
            <a href="Attendance_Players.html">View Registered Players</a>
            <a class="active" href="Attendance_Winrate.html">Go back to viewing Winrate</a>
            <a href="Attendance_Attendance.html">View Attendance</a>
            <a href="Attendance_Make_Player.html">Create Player</a>
            <a href="./Attendance_Logger.html">Log a Match!</a>
        </div>
        <br>
        <main>
            <p>Note: These rankings are based off of your skill ranking, not your winrate. That's why people with higher wintrates may be lower than you.</p>
            <p id="TimeUntilUpdate"></p>
            <ol id="Rankings">
                <li>XX</li>
                <li>XX</li>
                <li>XX</li>
            </ol>
        </main>
    </body>
</html>